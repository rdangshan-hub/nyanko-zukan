<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã«ã‚ƒã‚“ã“å›³é‘‘ Pro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="ã«ã‚ƒã‚“ã“å›³é‘‘">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <style>
    body {
      margin:0; font-family:sans-serif;
      background:#121212; color:#fff;
    }
    header {
      display:flex; justify-content:space-between; align-items:center;
      padding:10px; background:#1e1e1e;
    }
    header h1 { font-size:18px; margin:0; }
    nav button {
      margin:0 5px; padding:8px 12px;
      background:#333; color:#fff; border:none; border-radius:5px;
      cursor:pointer;
    }
    nav button.active { background:#555; }
    #darkToggle { cursor:pointer; }
    .tab { display:none; padding:10px; }
    .tab.active { display:block; }
    input, select, textarea {
      background:#1e1e1e; color:#fff;
      border:1px solid #555; border-radius:4px; padding:4px;
    }
    textarea { width:100%; min-height:60px; }
    .save-btn {
      font-size:20px; padding:10px 20px; margin-bottom:10px;
      background:#2a2a2a; color:#fff; border:none; border-radius:6px;
      cursor:pointer;
    }
    .cat-card {
      background:#1e1e1e; margin:10px 0; padding:10px;
      border-radius:6px; display:flex; justify-content:space-between;
      align-items:center;
    }
    .cat-card img { width:50px; height:50px; object-fit:cover; margin-right:10px; }
    .cat-info { display:flex; align-items:center; }
    .card-buttons button {
      margin-left:5px; padding:5px 10px; border:none; border-radius:4px;
      background:#333; color:#fff; cursor:pointer;
    }
    /* Gridè¡¨ç¤º */
    .grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(80px,1fr)); gap:10px; }
    .grid .cat-card { flex-direction:column; justify-content:center; }
    .grid .cat-card img { width:70px; height:70px; margin:0; }
    .grid .card-buttons { display:none; }
    /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
    #modal {
      display:none; position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.8); justify-content:center; align-items:center;
    }
    #modal-content {
      background:#1e1e1e; padding:20px; border-radius:10px;
      max-width:600px; width:90%; max-height:90%; overflow:auto;
    }
    .close-btn { background:#333; color:#fff; border:none; padding:5px 10px; cursor:pointer; }
    .traits { margin:5px 0; }
  </style>
</head>
<body>
  <header>
    <h1>ã«ã‚ƒã‚“ã“å›³é‘‘ Pro</h1>
    <div>
      <span id="darkToggle">ğŸŒ™</span>
    </div>
  </header>
  <nav>
    <button onclick="switchTab('register')" class="active">ç™»éŒ²</button>
    <button onclick="switchTab('catalog')">å›³é‘‘</button>
    <button onclick="switchTab('trash')">ã‚´ãƒŸç®±</button>
  </nav>

  <!-- ç™»éŒ²ã‚¿ãƒ– -->
  <div id="register" class="tab active">
    <button class="save-btn" onclick="saveCat()">ä¿å­˜</button>
    <div>
      No.<input type="number" id="catNo" style="width:80px">
      ãƒ¬ã‚¢:<select id="rarity">
        <option>åŸºæœ¬</option><option>EX</option><option>ãƒ¬ã‚¢</option>
        <option>æ¿€ãƒ¬ã‚¢</option><option>è¶…æ¿€ãƒ¬ã‚¢</option><option>ä¼èª¬ãƒ¬ã‚¢</option>
      </select>
    </div>
    <div id="forms"></div>
  </div>

  <!-- å›³é‘‘ã‚¿ãƒ– -->
  <div id="catalog" class="tab">
    <div>
      æ¤œç´¢:<input type="text" id="search">
      è¡¨ç¤º:<select id="viewMode" onchange="renderList()">
        <option value="list">ãƒªã‚¹ãƒˆ</option>
        <option value="grid">ã‚°ãƒªãƒƒãƒ‰</option>
      </select>
    </div>
    <div id="cat-list"></div>
  </div>

  <!-- ã‚´ãƒŸç®±ã‚¿ãƒ– -->
  <div id="trash" class="tab">
    <div id="trash-list"></div>
  </div>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="modal"><div id="modal-content">
    <div id="modal-body"></div>
    <button class="close-btn" onclick="closeModal()">é–‰ã˜ã‚‹</button>
  </div></div>

  <script>
    let cats = [];
    let trash = [];
    const FPS30=30, FPS27=27;

    // åˆæœŸãƒ­ãƒ¼ãƒ‰
    window.onload = () => {
      cats = JSON.parse(localStorage.getItem("cats")||"[]");
      trash = JSON.parse(localStorage.getItem("trash")||"[]");
      cleanupTrash();
      renderList(); renderTrash(); renderForms();
    };

    function save(){ localStorage.setItem("cats", JSON.stringify(cats)); localStorage.setItem("trash", JSON.stringify(trash)); }

    function switchTab(id){
      document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
      document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
      document.querySelector(`nav button[onclick="switchTab('${id}')"]`).classList.add("active");
      document.getElementById(id).classList.add("active");
      if(id==="catalog") renderList();
      if(id==="trash") renderTrash();
    }

    // ãƒ•ã‚©ãƒ¼ãƒ æç”»
    function renderForms(){
      let html="";
      for(let i=1;i<=4;i++){
        html+=`
        <div style="border:1px solid #333;margin:10px 0;padding:10px;">
          <h3>ç¬¬${i}å½¢æ…‹</h3>
          å½¢æ…‹å:<input type="text" id="name${i}"><br>
          ç”»åƒ:<input type="file" id="img${i}" accept="image/*"><br>
          èª¬æ˜:<textarea id="desc${i}"></textarea><br>
          ä½“åŠ›:<input type="number" id="hp${i}" style="width:80px">
          æ”»æ’ƒåŠ›:<input type="number" id="atk${i}" style="width:80px"><br>
          DPS:<input type="number" id="dps${i}" style="width:80px">
          ã‚³ã‚¹ãƒˆ:<input type="number" id="cost${i}" style="width:80px"><br>
          KBæ•°:<input type="number" id="kb${i}" style="width:80px">
          ç§»å‹•é€Ÿåº¦:<input type="number" id="spd${i}" style="width:80px"><br>
          æœ€ç”Ÿç”£æ™‚é–“:<input type="number" id="resp${i}" style="width:80px">ç§’<br>
          æ”»æ’ƒç™ºç”Ÿ:<input type="number" id="start${i}" style="width:80px">
          æ”»æ’ƒé »åº¦:<input type="number" id="freq${i}" style="width:80px">ç§’<br>
          ç‰¹æ€§:<div id="traits${i}"></div>
          <button onclick="addTrait(${i})">ç‰¹æ€§è¿½åŠ </button>
        </div>`;
      }
      document.getElementById("forms").innerHTML=html;
    }

    function addTrait(formIdx){
      let div=document.getElementById("traits"+formIdx);
      let id=Date.now();
      let el=document.createElement("div");
      el.className="traits";
      el.innerHTML=`<input placeholder="ç‰¹æ€§å">
        ç¢ºç‡:<input type="number" style="width:60px">%
        æ™‚é–“:<input type="number" style="width:60px">
        Lv:<input type="number" style="width:50px">
        <button onclick="this.parentNode.remove()">âœ–</button>`;
      div.appendChild(el);
    }

    // ä¿å­˜
    function saveCat(){
      let cat={ no:document.getElementById("catNo").value, rarity:document.getElementById("rarity").value, forms:[] };
      for(let i=1;i<=4;i++){
        let traits=[...document.querySelectorAll("#traits"+i+" .traits")].map(t=>{
          let inputs=t.querySelectorAll("input");
          return {name:inputs[0].value, prob:inputs[1].value, time:inputs[2].value, level:inputs[3].value};
        });
        cat.forms.push({
          name:document.getElementById("name"+i).value,
          desc:document.getElementById("desc"+i).value,
          hp:document.getElementById("hp"+i).value,
          atk:document.getElementById("atk"+i).value,
          dps:document.getElementById("dps"+i).value,
          cost:document.getElementById("cost"+i).value,
          kb:document.getElementById("kb"+i).value,
          spd:document.getElementById("spd"+i).value,
          resp:document.getElementById("resp"+i).value,
          start:document.getElementById("start"+i).value,
          freq:document.getElementById("freq"+i).value,
          traits:traits
        });
      }
      cats.push(cat); save(); renderList();
      alert("ä¿å­˜ã—ã¾ã—ãŸï¼");
    }

    // å›³é‘‘
    function renderList(){
      const mode=document.getElementById("viewMode").value;
      let list=document.getElementById("cat-list");
      list.innerHTML="";
      list.className=mode==="grid"?"grid":"";
      cats.forEach((cat,idx)=>{
        let card=document.createElement("div");
        card.className="cat-card";
        card.innerHTML=`<div class="cat-info"><div>No.${cat.no} ${cat.forms[0].name||"???"}</div></div>
        <div class="card-buttons">
          <button onclick="openModal(${idx})">è©³ç´°</button>
          <button onclick="deleteCat(${idx})">å‰Šé™¤</button>
        </div>`;
        list.appendChild(card);
      });
    }

    // ã‚´ãƒŸç®±
    function deleteCat(idx){
      let c=cats.splice(idx,1)[0];
      c.deletedAt=Date.now();
      trash.push(c);
      save(); renderList(); renderTrash();
    }
    function renderTrash(){
      let list=document.getElementById("trash-list");
      list.innerHTML="";
      trash.forEach((cat,idx)=>{
        let card=document.createElement("div");
        card.className="cat-card";
        card.innerHTML=`<div>No.${cat.no} ${cat.forms[0].name}</div>
        <div class="card-buttons">
          <button onclick="restoreCat(${idx})">å¾©å…ƒ</button>
          <button onclick="purgeCat(${idx})">å®Œå…¨å‰Šé™¤</button>
        </div>`;
        list.appendChild(card);
      });
    }
    function restoreCat(idx){
      cats.push(trash.splice(idx,1)[0]);
      save(); renderList(); renderTrash();
    }
    function purgeCat(idx){
      trash.splice(idx,1); save(); renderTrash();
    }
    function cleanupTrash(){
      const week=1000*60*60*24*7;
      trash=trash.filter(c=>Date.now()-c.deletedAt<week);
      save();
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«
    function openModal(idx){
      let cat=cats[idx];
      let body=`<h2>No.${cat.no} ${cat.rarity}</h2>`;
      cat.forms.forEach((f,i)=>{
        body+=`<h3>ç¬¬${i+1}å½¢æ…‹ ${f.name}</h3>
        <p>${f.desc.replace(/\n/g,"<br>")}</p>
        <p>HP:${f.hp} æ”»æ’ƒ:${f.atk} DPS:${f.dps} ã‚³ã‚¹ãƒˆ:${f.cost}</p>
        <p>KB:${f.kb} é€Ÿåº¦:${f.spd} å†ç”Ÿç”£:${f.resp}ç§’ æ”»æ’ƒç™ºç”Ÿ:${f.start} æ”»æ’ƒé »åº¦:${f.freq}ç§’</p>
        <p>ç‰¹æ€§:<ul>`+f.traits.map(t=>`<li>${t.name} ${t.prob}% ${t.time}ç§’ Lv${t.level}</li>`).join("")+`</ul></p>`;
      });
      document.getElementById("modal-body").innerHTML=body;
      document.getElementById("modal").style.display="flex";
    }
    function closeModal(){ document.getElementById("modal").style.display="none"; }

    // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
    document.getElementById("darkToggle").onclick=()=>{
      document.body.classList.toggle("light");
      if(document.body.classList.contains("light")){
        document.body.style.background="#fff";
        document.body.style.color="#000";
      }else{
        document.body.style.background="#121212";
        document.body.style.color="#fff";
      }
    };
  </script>
</body>
</html>
